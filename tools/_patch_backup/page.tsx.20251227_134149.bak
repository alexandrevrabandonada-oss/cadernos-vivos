import type { CSSProperties } from "react";
import { getCaderno, getAula } from "@/lib/cadernos";
import Markdown from "@/components/Markdown";
import { CadernoHeader, NavPills } from "@/components/CadernoHeader";
import Link from "next/link"; import AulaProgress from "@/components/AulaProgress";

type AccentStyle = CSSProperties & { ["--accent"]?: string };

export default async function Page({ params }: { params: Promise<{ slug: string; aula: string }> }) {
  const { slug, aula } = await params;
  const data = await getCaderno(slug);
  const total = data.aulas.length;
  const num = Number(aula);
  const aulaData = await getAula(slug, "aula-" + String(num));
  const prev = num > 1 ? ("/c/" + slug + "/a/" + String(num - 1)) : null;
  const next = num < total ? ("/c/" + slug + "/a/" + String(num + 1)) : null;
  const s: AccentStyle = { ["--accent"]: data.meta.accent };

  return (
    <main className="space-y-5" style={s}>
      <CadernoHeader title={data.meta.title} subtitle={data.meta.subtitle} ethos={data.meta.ethos} />
      <NavPills slug={slug} />
      <AulaProgress total={total} current={num} /> <div className="card p-5">
        <div className="text-xs muted">Aula {String(num)} / {String(total)}</div>
        <h2 className="text-xl font-semibold mt-1">Aula {String(num)}</h2>
        <div className="mt-4"><Markdown markdown={aulaData.markdown} /></div>
        <div className="mt-6 flex gap-2">
          {prev ? <Link className="card px-3 py-2 hover:bg-white/10 transition" href={prev}>Anterior</Link> : null}
          {next ? <Link className="card px-3 py-2 hover:bg-white/10 transition" href={next}>Pr√≥xima</Link> : null}
        </div>
      </div>
    </main>
  );
}