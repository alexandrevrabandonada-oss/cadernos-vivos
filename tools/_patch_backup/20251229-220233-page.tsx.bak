import V2Nav from "@/components/v2/V2Nav";
import DebateV2 from "@/components/v2/DebateV2";
import { loadCadernoV2 } from "@/lib/v2";

function titleFromMeta(meta: unknown, fallback: string): string {
  if (typeof meta !== "object" || meta === null) return fallback;
  const r = meta as { title?: unknown };
  return typeof r.title === "string" && r.title.trim() ? r.title : fallback;
}

export default async function Page(props: { params: { slug: string } }) {
  const slug = (await props.params).slug;
  const c = await loadCadernoV2(slug);

  const meta = (c as unknown as { meta?: unknown }).meta;
  const title = titleFromMeta(meta, slug);

  const bag = c as unknown as { debate?: unknown; discussao?: unknown; forum?: unknown; comentarios?: unknown; comments?: unknown; mensagens?: unknown; messages?: unknown };
  const debate = bag.debate ?? bag.discussao ?? bag.forum ?? bag.comentarios ?? bag.comments ?? bag.mensagens ?? bag.messages ?? null;

  return (
    <main style={{ padding: 18 }}>
      <V2Nav slug={slug} active="debate" />
      <DebateV2 slug={slug} title={title} debate={debate} />
    </main>
  );
}