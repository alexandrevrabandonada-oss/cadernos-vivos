import Link from "next/link";
import React from "react";

export type TrailStep = { id?: string; title?: string; href?: string; kind?: string };
export type Trail = { id: string; title: string; summary?: string; steps?: TrailStep[] };

function countSteps(t: Trail): number {
  return Array.isArray(t.steps) ? t.steps.length : 0;
}

export function TrilhasV2(props: { slug: string; title: string; trails: Trail[] }) {
  const trails = Array.isArray(props.trails) ? props.trails : [];

  return (
    <div style={{ display: "grid", gap: 12 }}>
      <header
        style={{
          border: "1px solid rgba(255,255,255,0.10)",
          borderRadius: 14,
          padding: 12,
          background: "rgba(0,0,0,0.22)",
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          gap: 12,
          flexWrap: "wrap",
        }}
      >
        <div style={{ display: "flex", flexDirection: "column", gap: 2 }}>
          <div style={{ fontSize: 12, opacity: 0.75 }}>Trilhas V2</div>
          <div style={{ fontSize: 16, fontWeight: 900 }}>{props.title}</div>
        </div>
        <div
          style={{
            fontSize: 12,
            opacity: 0.9,
            padding: "6px 10px",
            borderRadius: 999,
            border: "1px solid rgba(255,255,255,0.12)",
          }}
        >
          {trails.length} trilha(s)
        </div>
      </header>

      {trails.length ? (
        <div style={{ display: "grid", gap: 10 }}>
          {trails.map((t) => {
            const steps = countSteps(t);
            const href = "/c/" + props.slug + "/v2/trilhas/" + encodeURIComponent(t.id);
            return (
              <section
                key={t.id}
                style={{
                  borderRadius: 14,
                  padding: 12,
                  border: "1px solid rgba(255,255,255,0.10)",
                  background: "rgba(0,0,0,0.18)",
                  display: "grid",
                  gap: 10,
                }}
              >
                <div style={{ display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: 12, flexWrap: "wrap" }}>
                  <div style={{ display: "grid", gap: 6, minWidth: 260 }}>
                    <div style={{ fontSize: 14, fontWeight: 950 }}>{t.title}</div>
                    {t.summary ? (
                      <div style={{ fontSize: 13, lineHeight: 1.45, opacity: 0.95 }}>{t.summary}</div>
                    ) : null}
                    <div style={{ fontSize: 12, opacity: 0.75 }}>id: {t.id}</div>
                  </div>

                  <div style={{ display: "flex", alignItems: "center", gap: 10, flexWrap: "wrap" }}>
                    <span
                      style={{
                        fontSize: 12,
                        opacity: 0.9,
                        padding: "6px 10px",
                        borderRadius: 999,
                        border: "1px solid rgba(255,255,255,0.12)",
                      }}
                    >
                      {steps} etapa(s)
                    </span>
                    <Link
                      href={href}
                      style={{
                        display: "inline-flex",
                        alignItems: "center",
                        justifyContent: "center",
                        gap: 8,
                        fontSize: 12,
                        fontWeight: 900,
                        padding: "10px 12px",
                        borderRadius: 12,
                        textDecoration: "none",
                        color: "#111",
                        background: "var(--accent)",
                        border: "1px solid rgba(0,0,0,0.35)",
                      }}
                      title="Abrir trilha"
                    >
                      Abrir
                    </Link>
                  </div>
                </div>
              </section>
            );
          })}
        </div>
      ) : (
        <div
          style={{
            borderRadius: 14,
            padding: 12,
            border: "1px solid rgba(255,255,255,0.10)",
            background: "rgba(0,0,0,0.18)",
            fontSize: 13,
            lineHeight: 1.55,
            opacity: 0.95,
          }}
        >
          Nenhuma trilha ainda. VocÃª pode criar um arquivo <b>trilhas.json</b> dentro do caderno ou adicionar nodes no mapa com <b>type: &quot;trail&quot;</b>.
        </div>
      )}

      <footer
        style={{
          borderRadius: 14,
          padding: 12,
          border: "1px solid rgba(255,255,255,0.10)",
          background: "rgba(0,0,0,0.14)",
          fontSize: 12,
          opacity: 0.9,
          lineHeight: 1.6,
        }}
      >
        <div style={{ fontWeight: 900, marginBottom: 6 }}>Formato sugerido (trilhas.json)</div>
        <div style={{ opacity: 0.85 }}>
          Top-level pode ser array de trilhas. Cada trilha: id, title, summary opcional, steps opcional (id/title/href).
        </div>
      </footer>
    </div>
  );
}