import type { CSSProperties } from "react";
import { getCaderno } from "@/lib/cadernos";
import V2Nav from "@/components/v2/V2Nav";
import ProvasV2 from "@/components/v2/ProvasV2";

type AnyParams = { slug: string } | Promise<{ slug: string }>; 

type AccentStyle = CSSProperties & Record<"--accent", string>;

async function getSlug(params: AnyParams): Promise<string> {
  const p = await Promise.resolve(params as unknown as { slug: string });
  return (p && p.slug) ? p.slug : "";
}

export default async function Page({ params }: { params: AnyParams }) {
  const slug = await getSlug(params);
  const data = await getCaderno(slug);
  const meta = (data && (data as unknown as { meta?: unknown }).meta) ? (data as unknown as { meta: unknown }).meta : null;
  const title = (data && (data as unknown as { title?: string }).title) ? (data as unknown as { title: string }).title : slug;

  const accent = (meta && typeof (meta as any).accent === "string") ? (meta as any).accent : "#F5C400";
  const s: AccentStyle = { ["--accent"]: accent };

  return (
    <main style={{ padding: 18, maxWidth: 1100, margin: "0 auto" }}>
      <div style={s as any} />
      <V2Nav slug={slug} active={"provas" as any} />
      <div style={{ marginTop: 12 }}>
        <ProvasV2 slug={slug} title={title} />
      </div>
    </main>
  );
}